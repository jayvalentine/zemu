require 'rake/testtask'
require 'rdoc/task'
require 'yard'

# The location of this rakefile.
HERE = __dir__

namespace :test do
    desc "Run config tests"
    Rake::TestTask.new :config do |t|
        t.test_files = FileList['test/config/test_*.rb']
    end

    desc "Run emulator tests"
    Rake::TestTask.new :emulator do |t|
        t.test_files = FileList['test/emulator/test_*.rb']
    end

    desc "Run build tests"
    Rake::TestTask.new :build do |t|
        t.test_files = FileList['test/build/test_*.rb']
    end

    desc "Run all tests"
    Rake::TestTask.new :all => [:config, :build, :emulator]
end

namespace :docs do
    desc "Generate documentation"
    task :build do
        system("rm -r #{File.join(HERE, "doc")}")
        
        output = `yardoc`

        unless /100.00% documented/ =~ output
            system("yard stats --list-undoc")
            puts ""
            abort("Aborting task due to missing documentation!")
        end
    end

    desc "View documentation"
    task :view => :build do
        system "firefox #{File.join(HERE, "doc", "index.html")}"
    end
end